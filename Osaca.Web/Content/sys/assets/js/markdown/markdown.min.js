(function(n){function y(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function w(){var n=require("util");return"Markdown.mk_block( "+n.inspect(this.toString())+", "+n.inspect(this.trailing)+", "+n.inspect(this.lineNumber)+" )"}function s(n){for(var t=0,i=-1;(i=n.indexOf("\n",i+1))!==-1;)t++;return t}function e(n,t){function u(n){this.len_after=n;this.name="close_"+t}var i=n+"_state",r=n=="strong"?"em_state":"strong_state";return function(f){var o,s,c;if(this[i][0]==t)return this[i].shift(),[f.length,new u(f.length-t.length)];o=this[r].slice();s=this[i].slice();this[i].unshift(t);var e=this.processInline(f.substr(t.length)),h=e[e.length-1],l=this[i].shift();return h instanceof u?(e.pop(),c=f.length-h.len_after,[c,[n].concat(e)]):(this[r]=o,this[i]=s,[t.length,t])}}function b(n){for(var r=n.split(""),t=[""],u=!1,i;r.length;){i=r.shift();switch(i){case" ":u?t[t.length-1]+=i:t.push("");break;case"'":case'"':u=!u;break;case"\\":i=r.shift();default:t[t.length-1]+=i}}return t}function r(n){return f(n)&&n.length>1&&typeof n[1]=="object"&&!f(n[1])?n[1]:undefined}function c(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function o(n){var i,u;if(typeof n=="string")return c(n);var t=n.shift(),r={},f=[];for(!n.length||typeof n[0]!="object"||n[0]instanceof Array||(r=n.shift());n.length;)f.push(o(n.shift()));i="";for(u in r)i+=" "+u+'="'+c(r[u])+'"';return t=="img"||t=="br"||t=="hr"?"<"+t+i+"/>":"<"+t+i+">"+f.join("")+"<\/"+t+">"}function l(n,t,i){var e,u,f,s,o,h;if(i=i||{},u=n.slice(0),typeof i.preprocessTreeNode=="function"&&(u=i.preprocessTreeNode(u,t)),f=r(u),f){u[1]={};for(e in f)u[1][e]=f[e];f=u[1]}if(typeof u=="string")return u;switch(u[0]){case"header":u[0]="h"+u[1].level;delete u[1].level;break;case"bulletlist":u[0]="ul";break;case"numberlist":u[0]="ol";break;case"listitem":u[0]="li";break;case"para":u[0]="p";break;case"markdown":u[0]="html";f&&delete f.references;break;case"code_block":u[0]="pre";e=f?2:1;s=["code"];s.push.apply(s,u.splice(e,u.length-e));u[e]=s;break;case"inlinecode":u[0]="code";break;case"img":u[1].src=u[1].href;delete u[1].href;break;case"linebreak":u[0]="br";break;case"link":u[0]="a";break;case"link_ref":if(u[0]="a",o=t[f.ref],o)delete f.ref,f.href=o.href,o.title&&(f.title=o.title),delete f.original;else return f.original;break;case"img_ref":if(u[0]="img",o=t[f.ref],o)delete f.ref,f.src=o.href,o.title&&(f.title=o.title),delete f.original;else return f.original}if(e=1,f){for(h in u[1]){e=2;break}e===1&&u.splice(e,1)}for(;e<u.length;++e)u[e]=l(u[e],t,i);return u}function v(n){for(var t=r(n)?2:1;t<n.length;)typeof n[t]=="string"?t+1<n.length&&typeof n[t+1]=="string"?n[t]+=n.splice(t+1,1)[0]:++t:(v(n[t]),++t)}var t=n.Markdown=function(n){switch(typeof n){case"undefined":this.dialect=t.dialects.Gruber;break;case"object":this.dialect=n;break;default:if(n in t.dialects)this.dialect=t.dialects[n];else throw new Error("Unknown Markdown dialect '"+String(n)+"'");}this.em_state=[];this.strong_state=[];this.debug_indent=""},i,f,u,h;n.parse=function(n,i){var r=new t(i);return r.toTree(n)};n.toHTML=function(t,i,r){var u=n.toHTMLTree(t,i,r);return n.renderJsonML(u)};n.toHTMLTree=function(n,t,i){var u,f,e;return typeof n=="string"&&(n=this.parse(n,t)),u=r(n),f={},u&&u.references&&(f=u.references),e=l(n,f,i),v(e),e};i=t.mk_block=function(n,t,i){arguments.length==1&&(t="\n\n");var r=new String(n);return r.trailing=t,r.inspect=w,r.toSource=y,i!=undefined&&(r.lineNumber=i),r};t.prototype.split_blocks=function(n){n=n.replace(/(\r\n|\n|\r)/g,"\n");var r=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,f=[],t,u=1;for((t=/^(\s*\n)/.exec(n))!=null&&(u+=s(t[0]),r.lastIndex=t[0].length);(t=r.exec(n))!==null;)t[2]=="\n#"&&(t[2]="\n",r.lastIndex--),f.push(i(t[1],t[2],u)),u+=s(t[0]);return f};t.prototype.processBlock=function(n,t){var u=this.dialect.block,e=u.__order__,r,i;if("__call__"in u)return u.__call__.call(this,n,t);for(r=0;r<e.length;r++)if(i=u[e[r]].call(this,n,t),i)return(!f(i)||i.length>0&&!f(i[0]))&&this.debug(e[r],"didn't return a proper array"),i;return[]};t.prototype.processInline=function(n){return this.dialect.inline.__call__.call(this,String(n))};t.prototype.toTree=function(n,t){var i=n instanceof Array?n:this.split_blocks(n),u=this.tree,r;try{this.tree=t||this.tree||["markdown"];n:while(i.length)(r=this.processBlock(i.shift(),i),r.length)&&this.tree.push.apply(this.tree,r);return this.tree}finally{t&&(this.tree=u)}};t.prototype.debug=function(){var n=Array.prototype.slice.call(arguments);n.unshift(this.debug_indent);typeof print!="undefined"&&print.apply(print,n);typeof console!="undefined"&&typeof console.log!="undefined"&&console.log.apply(null,n)};t.prototype.loop_re_over_block=function(n,t,i){for(var u,r=t.valueOf();r.length&&(u=n.exec(r))!=null;)r=r.substr(u[0].length),i.call(this,u);return r};t.dialects={};t.dialects.Gruber={block:{atxHeader:function(n,t){var r=n.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/),u;return r?(u=["header",{level:r[1].length}],Array.prototype.push.apply(u,this.processInline(r[2])),r[0].length<n.length&&t.unshift(i(n.substr(r[0].length),n.trailing,n.lineNumber+2)),[u]):undefined},setextHeader:function(n,t){var r=n.match(/^(.*)\n([-=])\2\2+(?:\n|$)/),u,f;return r?(u=r[2]==="="?1:2,f=["header",{level:u},r[1]],r[0].length<n.length&&t.unshift(i(n.substr(r[0].length),n.trailing,n.lineNumber+2)),[f]):undefined},code:function(n,t){var r=[],u=/^(?: {0,3}\t| {4})(.*)\n?/,f;if(!n.match(u))return undefined;n:do if(f=this.loop_re_over_block(u,n.valueOf(),function(n){r.push(n[1])}),f.length){t.unshift(i(f,n.trailing));break n}else if(t.length){if(!t[0].match(u))break n;r.push(n.trailing.replace(/[^\n]/g,"").substring(2));n=t.shift()}else break n;while(1);return[["code_block",r.join("\n")]]},horizRule:function(n,t){var r=n.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/),u;return r?(u=[["hr"]],r[1]&&u.unshift.apply(u,this.processBlock(r[1],[])),r[3]&&t.unshift(i(r[3])),u):undefined},lists:function(){function s(i){return new RegExp("(?:^("+n+"{0,"+i+"} {0,3})("+t+")\\s+)|(^"+n+"{0,"+(i-1)+"}[ ]{0,4})")}function h(n){return n.replace(/ {0,3}\t/g,"    ")}function f(n,t,i,r){var u,f,e,o;if(t){n.push(["para"].concat(i));return}for(u=n[n.length-1]instanceof Array&&n[n.length-1][0]=="para"?n[n.length-1]:n,r&&n.length>1&&i.unshift(r),f=0;f<i.length;f++)e=i[f],o=typeof e=="string",o&&u.length>1&&typeof u[u.length-1]=="string"?u[u.length-1]+=e:u.push(e)}function c(t,r){for(var o=new RegExp("^("+n+"{"+t+"}.*?\\n?)*$"),s=new RegExp("^"+n+"{"+t+"}","gm"),f=[],u,e;r.length>0;)if(o.exec(r[0]))u=r.shift(),e=u.replace(s,""),f.push(i(e,u.trailing,u.lineNumber));else break;return f}function e(n,t,i){var u=n.list,r=u[u.length-1],f;r[1]instanceof Array&&r[1][0]=="para"||(t+1==i.length?r.push(["para"].concat(r.splice(1,r.length-1))):(f=r.pop(),r.push(["para"].concat(r.splice(1,r.length-1)),f)))}var t="[*+-]|\\d+\\.",o=/[*+-]/,r=new RegExp("^( {0,3})("+t+")[ \t]+"),n="(?: {0,3}\\t| {4})";return function(n,t){function g(n){var t=o.exec(n[2])?["bulletlist"]:["numberlist"];return i.push({list:t,indent:n[1]}),t}var l=n.match(r),tt,y,d,w,rt,ut,ft,et;if(!l)return undefined;var i=[],v=g(l),a,b=!1,nt=[i[0].list],p;n:for(;;){for(tt=n.split(/(?=\n)/),y="",d=0;d<tt.length;d++){var k="",it=tt[d].replace(/^\n/,function(n){return k=n,""}),ot=s(i.length);if(l=it.match(ot),l[1]!==undefined){if(y.length&&(f(a,b,this.processInline(y),k),b=!1,y=""),l[1]=h(l[1]),w=Math.floor(l[1].length/4)+1,w>i.length)v=g(l),a.push(v),a=v[1]=["listitem"];else{for(rt=!1,p=0;p<i.length;p++)if(i[p].indent==l[1]){v=i[p].list;i.splice(p+1,i.length-(p+1));rt=!0;break}rt||(w++,w<=i.length?(i.splice(w,i.length-w),v=i[w-1].list):(v=g(l),a.push(v)));a=["listitem"];v.push(a)}k=""}it.length>l[0].length&&(y+=k+it.substr(l[0].length))}if(y.length&&(f(a,b,this.processInline(y),k),b=!1,y=""),ut=c(i.length,t),ut.length>0&&(u(i,e,this),a.push.apply(a,this.toTree(ut,[]))),ft=t[0]&&t[0].valueOf()||"",ft.match(r)||ft.match(/^ /)){if(n=t.shift(),et=this.dialect.block.horizRule(n,t),et){nt.push.apply(nt,et);break}u(i,e,this);b=!0;continue n}break}return nt}}(),blockquote:function(n,t){var u,a,o;if(!n.match(/^>/m))return undefined;if(u=[],n[0]!=">"){for(var f=n.split(/\n/),c=[],l=n.lineNumber;f.length&&f[0][0]!=">";)c.push(f.shift()),l++;a=i(c.join("\n"),"\n",n.lineNumber);u.push.apply(u,this.processBlock(a,[]));n=i(f.join("\n"),n.trailing,l)}while(t.length&&t[0][0]==">")o=t.shift(),n=i(n+n.trailing+o,o.trailing,n.lineNumber);var v=n.replace(/^> ?/gm,""),y=this.tree,s=this.toTree(v,["blockquote"]),e=r(s);return e&&e.references&&(delete e.references,h(e)&&s.splice(1,1)),u.push(s),u},referenceDefn:function(n,t){var e=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/,u,f;return n.match(e)?(r(this.tree)||this.tree.splice(1,0,{}),u=r(this.tree),u.references===undefined&&(u.references={}),f=this.loop_re_over_block(e,n,function(n){n[2]&&n[2][0]=="<"&&n[2][n[2].length-1]==">"&&(n[2]=n[2].substring(1,n[2].length-1));var t=u.references[n[1].toLowerCase()]={href:n[2]};n[4]!==undefined?t.title=n[4]:n[5]!==undefined&&(t.title=n[5])}),f.length&&t.unshift(i(f,n.trailing)),[]):undefined},para:function(n){return[["para"].concat(this.processInline(n))]}}};t.dialects.Gruber.inline={__oneElement__:function(n,t,i){var r,f,u;if(t=t||this.dialect.inline.__patterns__,f=new RegExp("([\\s\\S]*?)("+(t.source||t)+")"),r=f.exec(n),r){if(r[1])return[r[1].length,r[1]]}else return[n.length,n];return r[2]in this.dialect.inline&&(u=this.dialect.inline[r[2]].call(this,n.substr(r.index),r,i||[])),u||[r[2].length,r[2]]},__call__:function(n,t){function f(n){typeof n=="string"&&typeof i[i.length-1]=="string"?i[i.length-1]+=n:i.push(n)}for(var i=[],r;n.length>0;)r=this.dialect.inline.__oneElement__.call(this,n,t,i),n=n.substr(r.shift()),u(r,f);return i},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(n){return this.dialect.inline.__escape__.exec(n)?[2,n.charAt(1)]:[1,"\\"]},"![":function(n){var t=n.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/),i;return t?(t[2]&&t[2][0]=="<"&&t[2][t[2].length-1]==">"&&(t[2]=t[2].substring(1,t[2].length-1)),t[2]=this.dialect.inline.__call__.call(this,t[2],/\\/)[0],i={alt:t[1],href:t[2]||""},t[4]!==undefined&&(i.title=t[4]),[t[0].length,["img",i]]):(t=n.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),t)?[t[0].length,["img_ref",{alt:t[1],ref:t[2].toLowerCase(),original:t[0]}]]:[2,"!["]},"[":function(n){var l=String(n),h=t.DialectHelpers.inline_until_char.call(this,n.substr(1),"]"),u,f,o,e,r,i,c,s;if(!h)return[1,"["];if(u=1+h[0],f=h[1],n=n.substr(u),r=n.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/),r){if(i=r[1],u+=r[0].length,i&&i[0]=="<"&&i[i.length-1]==">"&&(i=i.substring(1,i.length-1)),!r[3])for(c=1,s=0;s<i.length;s++)switch(i[s]){case"(":c++;break;case")":--c==0&&(u-=i.length-s,i=i.substring(0,s))}return i=this.dialect.inline.__call__.call(this,i,/\\/)[0],e={href:i||""},r[3]!==undefined&&(e.title=r[3]),o=["link",e].concat(f),[u,o]}return(r=n.match(/^\s*\[(.*?)\]/),r)?(u+=r[0].length,e={ref:(r[1]||String(f)).toLowerCase(),original:l.substr(0,u)},o=["link_ref",e].concat(f),[u,o]):f.length==1&&typeof f[0]=="string"?(e={ref:f[0].toLowerCase(),original:l.substr(0,u)},o=["link_ref",e,f[0]],[u,o]):[1,"["]},"<":function(n){var t;return(t=n.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))!=null?t[3]?[t[0].length,["link",{href:"mailto:"+t[3]},t[3]]]:t[2]=="mailto"?[t[0].length,["link",{href:t[1]},t[1].substr(7)]]:[t[0].length,["link",{href:t[1]},t[1]]]:[1,"<"]},"`":function(n){var t=n.match(/(`+)(([\s\S]*?)\1)/);return t&&t[2]?[t[1].length+t[2].length,["inlinecode",t[3]]]:[1,"`"]},"  \n":function(){return[3,["linebreak"]]}};t.dialects.Gruber.inline["**"]=e("strong","**");t.dialects.Gruber.inline.__=e("strong","__");t.dialects.Gruber.inline["*"]=e("em","*");t.dialects.Gruber.inline._=e("em","_");t.buildBlockOrder=function(n){var i=[];for(var t in n)t!="__order__"&&t!="__call__"&&i.push(t);n.__order__=i};t.buildInlinePatterns=function(n){var t=[],i,r,u;for(i in n)i.match(/^__.*__$/)||(r=i.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n"),t.push(i.length==1?r:"(?:"+r+")"));t=t.join("|");n.__patterns__=t;u=n.__call__;n.__call__=function(n,i){return i!=undefined?u.call(this,n,i):u.call(this,n,t)}};t.DialectHelpers={};t.DialectHelpers.inline_until_char=function(n,t){for(var i=0,r=[],u;;){if(n.charAt(i)==t)return i++,[i,r];if(i>=n.length)return null;u=this.dialect.inline.__oneElement__.call(this,n.substr(i));i+=u[0];r.push.apply(r,u.slice(1))}};t.subclassDialect=function(n){function t(){}function i(){}return t.prototype=n.block,i.prototype=n.inline,{block:new t,inline:new i}};t.buildBlockOrder(t.dialects.Gruber.block);t.buildInlinePatterns(t.dialects.Gruber.inline);t.dialects.Maruku=t.subclassDialect(t.dialects.Gruber);t.dialects.Maruku.processMetaHash=function(n){for(var u,i=b(n),r={},t=0;t<i.length;++t)/^#/.test(i[t])?r.id=i[t].substring(1):/^\./.test(i[t])?r["class"]=r["class"]?r["class"]+i[t].replace(/./," "):i[t].substring(1):/\=/.test(i[t])&&(u=i[t].split(/\=/),r[u[0]]=u[1]);return r};t.dialects.Maruku.block.document_meta=function(n){var t;if(n.lineNumber>1||!n.match(/^(?:\w+:.*\n)*\w+:.*$/))return undefined;r(this.tree)||this.tree.splice(1,0,{});t=n.split(/\n/);for(p in t){var i=t[p].match(/(\w+):\s*(.*)$/),u=i[1].toLowerCase(),f=i[2];this.tree[1][u]=f}return[]};t.dialects.Maruku.block.block_meta=function(n){var e=n.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/),i,t,u,o,f;if(!e)return undefined;if(i=this.dialect.processMetaHash(e[2]),e[1]===""){if(u=this.tree[this.tree.length-1],t=r(u),typeof u=="string")return undefined;t||(t={},u.splice(1,0,t));for(a in i)t[a]=i[a];return[]}o=n.replace(/\n.*$/,"");f=this.processBlock(o,[]);t=r(f[0]);t||(t={},f[0].splice(1,0,t));for(a in i)t[a]=i[a];return f};t.dialects.Maruku.block.definition_list=function(n,t){var f=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,e=["dl"],i,o,r,u;if(o=n.match(f)){for(r=[n];t.length&&f.exec(t[0]);)r.push(t.shift());for(u=0;u<r.length;++u){var o=r[u].match(f),s=o[1].replace(/\n$/,"").split(/\n/),h=o[2].split(/\n:\s+/);for(i=0;i<s.length;++i)e.push(["dt",s[i]]);for(i=0;i<h.length;++i)e.push(["dd"].concat(this.processInline(h[i].replace(/(\n)\s+/,"$1"))))}}else return undefined;return[e]};t.dialects.Maruku.block.table=function(n){var e=function(n,t){t=t||"\\s";t.match(/^[\\|\[\]{}?*.+^$]$/)&&(t="\\"+t);for(var i=[],u=new RegExp("^((?:\\\\.|[^\\\\"+t+"])*)"+t+"(.*)"),r;r=n.match(u);)i.push(r[1]),n=r[2];return i.push(n),i},i,t,f,r;if(t=n.match(/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/))t[3]=t[3].replace(/^\s*\|/gm,"");else if(!(t=n.match(/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/)))return undefined;for(f=["table",["thead",["tr"]],["tbody"]],t[2]=t[2].replace(/\|\s*$/,"").split("|"),r=[],u(t[2],function(n){n.match(/^\s*-+:\s*$/)?r.push({align:"right"}):n.match(/^\s*:-+\s*$/)?r.push({align:"left"}):n.match(/^\s*:-+:\s*$/)?r.push({align:"center"}):r.push({})}),t[1]=e(t[1].replace(/\|\s*$/,""),"|"),i=0;i<t[1].length;i++)f[1][1].push(["th",r[i]||{}].concat(this.processInline(t[1][i].trim())));return u(t[3].replace(/\|\s*$/mg,"").split("\n"),function(n){var t=["tr"];for(n=e(n,"|"),i=0;i<n.length;i++)t.push(["td",r[i]||{}].concat(this.processInline(n[i].trim())));f[2].push(t)},this),[f]};t.dialects.Maruku.inline["{:"]=function(n,t,i){var f,e,o,u,s;if(!i.length)return[2,"{:"];if(f=i[i.length-1],typeof f=="string")return[2,"{:"];if(e=n.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/),!e)return[2,"{:"];o=this.dialect.processMetaHash(e[1]);u=r(f);u||(u={},f.splice(1,0,u));for(s in o)u[s]=o[s];return[e[0].length,""]};t.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/;t.buildBlockOrder(t.dialects.Maruku.block);t.buildInlinePatterns(t.dialects.Maruku.inline);f=Array.isArray||function(n){return Object.prototype.toString.call(n)=="[object Array]"};u=Array.prototype.forEach?function(n,t,i){return n.forEach(t,i)}:function(n,t,i){for(var r=0;r<n.length;r++)t.call(i||n,n[r],r,n)};h=function(n){for(var t in n)if(hasOwnProperty.call(n,t))return!1;return!0};n.renderJsonML=function(n,t){t=t||{};t.root=t.root||!1;var i=[];if(t.root)i.push(o(n));else for(n.shift(),!n.length||typeof n[0]!="object"||n[0]instanceof Array||n.shift();n.length;)i.push(o(n.shift()));return i.join("\n\n")}})(function(){return typeof exports=="undefined"?(window.markdown={},window.markdown):exports}());
//# sourceMappingURL=markdown.min.js.map
