(function(n,t){function u(t,u){var f=this,ut=n(window),c=n(t),e=c.find(".nav-list"),v=c.find(".sidebar-toggle").eq(0),k=c.find(".sidebar-shortcuts").eq(0),s=e.get(0),tt,d,y,w;if(s){tt=ace.helper.getAttrSettings(t,n.fn.ace_sidebar_scroll.defaults);this.settings=n.extend({},n.fn.ace_sidebar_scroll.defaults,u,tt);d=f.settings.scroll_to_active;y=c.ace_sidebar("ref");c.attr("data-sidebar-scroll","true");var h=null,l=null,g=null,p=null,a=null,o=null;this.is_scrolling=!1;w=!1;this.sidebar_fixed=i(t,"fixed");var b,it,nt=function(){var n=e.parent().offset();return f.sidebar_fixed&&(n.top-=ace.helper.scrollTop()),ut.innerHeight()-n.top-(f.settings.include_toggle?0:v.outerHeight())+1},ft=function(){return s.clientHeight},rt=function(t){var i,u,c,y,tt;if(!w&&f.sidebar_fixed){e.wrap('<div class="nav-wrap-up pos-rel" />');e.after("<div><div><\/div><\/div>");e.wrap('<div class="nav-wrap" />');f.settings.include_toggle||v.css({"z-index":1});f.settings.include_shortcuts||k.css({"z-index":99});h=e.parent().next().ace_scroll({size:nt(),mouseWheelLock:!0,hoverReset:!1,dragEvent:!0,styleClass:f.settings.scroll_style,touchDrag:!1}).closest(".ace-scroll").addClass("nav-scroll");o=h.data("ace_scroll");l=h.find(".scroll-content").eq(0);g=l.find(" > div").eq(0);a=n(o.get_track());p=a.find(".scroll-bar").eq(0);f.settings.include_shortcuts&&k.length!=0&&(e.parent().prepend(k).wrapInner("<div />"),e=e.parent());f.settings.include_toggle&&v.length!=0&&(e.append(v),e.closest(".nav-wrap").addClass("nav-wrap-t"));e.css({position:"relative"});f.settings.scroll_outside==!0&&h.addClass("scrollout");s=e.get(0);s.style.top=0;l.on("scroll.nav",function(){s.style.top=-1*this.scrollTop+"px"});e.on(!n.event.special.mousewheel?"mousewheel.ace_scroll DOMMouseScroll.ace_scroll":"mousewheel.ace_scroll",function(n){return!f.is_scrolling||!o.is_active()?!f.settings.lock_anyway:h.trigger(n)});e.on("mouseenter.ace_scroll",function(){a.addClass("scroll-hover")}).on("mouseleave.ace_scroll",function(){a.removeClass("scroll-hover")});i=l.get(0);e.on("ace_drag.nav",function(t){if(!f.is_scrolling||!o.is_active()){t.retval.cancel=!0;return}if(n(t.target).closest(".can-scroll").length!=0){t.retval.cancel=!0;return}if(t.direction=="up"||t.direction=="down"){o.move_bar(!0);var r=t.dy;r=parseInt(Math.min(b,r));Math.abs(r)>2&&(r=r*2);r!=0&&(i.scrollTop=i.scrollTop+r,s.style.top=-1*i.scrollTop+"px")}});if(f.settings.smooth_scroll)e.on("touchstart.nav MSPointerDown.nav pointerdown.nav",function(){e.css("transition-property","none");p.css("transition-property","none")}).on("touchend.nav touchcancel.nav MSPointerUp.nav MSPointerCancel.nav pointerup.nav pointercancel.nav",function(){e.css("transition-property","top");p.css("transition-property","top")});if(r&&!f.settings.include_toggle&&(u=v.get(0),u))l.on("scroll.safari",function(){ace.helper.redraw(u)});if(w=!0,t==!0&&(f.reset(),d&&f.scroll_to_active(),d=!1),typeof f.settings.smooth_scroll=="number"&&f.settings.smooth_scroll>0){e.css({"transition-property":"top","transition-duration":(f.settings.smooth_scroll/1e3).toFixed(2)+"s"});p.css({"transition-property":"top","transition-duration":(f.settings.smooth_scroll/1500).toFixed(2)+"s"});h.on("drag.start",function(n){n.stopPropagation();e.css("transition-property","none")}).on("drag.end",function(n){n.stopPropagation();e.css("transition-property","top")})}if(ace.vars.android){c=ace.helper.scrollTop();c<2&&(window.scrollTo(c,0),setTimeout(function(){f.reset()},20));y=ace.helper.winHeight();n(window).on("scroll.ace_scroll",function(){f.is_scrolling&&o.is_active()&&(tt=ace.helper.winHeight(),tt!=y&&(y=tt,f.reset()))})}}};this.scroll_to_active=function(){var n,u,t,f,i,r;if(o&&o.is_active())try{for(u=y.vars(),t=c.find(".nav-list"),u.minimized&&!u.collapsible?n=t.find("> .active"):(n=e.find("> .active.hover"),n.length==0&&(n=e.find(".active:not(.open)"))),f=n.outerHeight(),t=t.get(0),i=n.get(0);i!=t;)f+=i.offsetTop,i=i.parentNode;r=f-h.height();r>0&&(s.style.top=-r+"px",l.scrollTop(r))}catch(a){}};this.reset=function(n){if(n===!0&&(this.sidebar_fixed=i(t,"fixed")),!this.sidebar_fixed){this.disable();return}w||rt();var r=y.vars(),u=!r.collapsible&&!r.horizontal&&(b=nt())<(it=s.clientHeight);this.is_scrolling=!0;u&&(g.css({height:it,width:8}),h.prev().css({"max-height":b}),o.update({size:b}),o.enable(),o.reset());u&&o.is_active()?c.addClass("sidebar-scroll"):this.is_scrolling&&this.disable()};this.disable=function(){if(this.is_scrolling=!1,h&&(h.css({height:"","max-height":""}),g.css({height:"",width:""}),h.prev().css({"max-height":""}),o.disable()),parseInt(s.style.top)<0&&f.settings.smooth_scroll&&n.support.transition.end)e.one(n.support.transition.end,function(){c.removeClass("sidebar-scroll");e.off(".trans")});else c.removeClass("sidebar-scroll");s.style.top=0};this.prehide=function(n){if(this.is_scrolling&&!y.get("minimized"))if(ft()+n<nt())this.disable();else if(n<0){var t=l.scrollTop()+n;if(t<0)return;s.style.top=-1*t+"px"}};this._reset=function(n){n===!0&&(this.sidebar_fixed=i(t,"fixed"));ace.vars.webkit?setTimeout(function(){f.reset()},0):this.reset()};this.set_hover=function(){a&&a.addClass("scroll-hover")};this.get=function(n){if(this.hasOwnProperty(n))return this[n]};this.set=function(n,t){this.hasOwnProperty(n)&&(this[n]=t)};this.ref=function(){return this};this.updateStyle=function(n){o!=null&&o.update({styleClass:n})};c.on("hidden.ace.submenu.sidebar_scroll shown.ace.submenu.sidebar_scroll",".submenu",function(n){n.stopPropagation();y.get("minimized")||(f._reset(),n.type=="shown"&&f.set_hover())});rt(!0)}}var r=ace.vars.safari&&navigator.userAgent.match(/version\/[1-5]/i),i="getComputedStyle"in window?function(n,t){return n.offsetHeight,window.getComputedStyle(n).position==t}:function(t,i){return t.offsetHeight,n(t).css("position")==i};n(document).on("settings.ace.sidebar_scroll",function(t,r){n(".sidebar[data-sidebar-scroll=true]").each(function(){var f=n(this),t=f.ace_sidebar_scroll("ref"),e,u;r=="sidebar_collapsed"&&i(this,"fixed")?(f.attr("data-sidebar-hover")=="true"&&f.ace_sidebar_hover("reset"),t._reset()):(r==="sidebar_fixed"||r==="navbar_fixed")&&(e=t.get("is_scrolling"),u=i(this,"fixed"),t.set("sidebar_fixed",u),u&&!e?t._reset():u||t.disable())})});n(window).on("resize.ace.sidebar_scroll",function(){n(".sidebar[data-sidebar-scroll=true]").each(function(){var r=n(this),t,u;r.attr("data-sidebar-hover")=="true"&&r.ace_sidebar_hover("reset");t=n(this).ace_sidebar_scroll("ref");u=i(this,"fixed");t.set("sidebar_fixed",u);t._reset()})});n.fn.ace_sidebar_scroll||(n.fn.ace_sidebar_scroll=function(i,r){var f,e=this.each(function(){var e=n(this),t=e.data("ace_sidebar_scroll"),o=typeof i=="object"&&i;t||e.data("ace_sidebar_scroll",t=new u(this,o));typeof i=="string"&&typeof t[i]=="function"&&(f=t[i](r))});return f===t?e:f},n.fn.ace_sidebar_scroll.defaults={scroll_to_active:!0,include_shortcuts:!0,include_toggle:!1,smooth_scroll:150,scroll_outside:!1,scroll_style:"",lock_anyway:!1})})(window.jQuery);